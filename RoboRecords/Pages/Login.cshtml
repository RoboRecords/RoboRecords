@page
@model RoboRecords.Pages.Login
<!--
 Login.cshtml: FrontEnd for the login website's page
 Copyright (C) 2021, Lemin <Leminn> and Refrag <R3FR4G>

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.
 See the 'LICENSE' file for more details.
-->

@{
    ViewData["Title"] = "Login";
}
<div class="container">
    <div>
        @if (Model.IsLoggedIn)
        {
            <h1>Welcome, @Model.CurrentUser.UserNameNoDiscrim!</h1>
            @if (Model.isModerator)
            {
                <h2>You are a moderator!</h2>}
            @using (Html.BeginForm(FormMethod.Post))
            {
                <button asp-page-handler="ApiKey">Generate new Api Key</button>
            }
        }
        else
        {
            <h1>You're not signed in yet</h1>
        }
    </div>
    
    <script type="text/javascript">
    function register() {
        $.ajax({
            type: 'POST',
            url: '?handler=Register',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ 
                Email: document.getElementById("exampleInputEmail1").value,
                Username: document.getElementById("exampleInputUsername1").value,
                Password: document.getElementById("exampleInputPassword1").value,
                PasswordConfirmation: document.getElementById("exampleInputConfirmPassword1").value,
            }),
            success: function (data) {
                console.log("Success: " + data);
                location.reload();
            },
            error: function (error) {
                // TODO: Inform the user of the outcome.
                console.log("Error: " + error);
            }
        })
    }
    function login() {
        $.ajax({
            type: 'POST',
            url: '?handler=Login',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ 
                Email: document.getElementById("exampleInputEmail2").value,
                Password: document.getElementById("exampleInputPassword2").value,
            }),
            success: function (data) {
                console.log("Success: " + data);
                location.reload();
            },
            error: function (error) {
                // TODO: Inform the user of the outcome.
                console.log("Error: " + error);
            }
        })
    }
    </script>

    <div class="row">
        <div id="registerBox" class="col-md-6">
            <span class="title-font" id="attractRegister">Register</span>
            <div class="form-group">
                <label for="exampleInputEmail1">Email:</label>
                <input name="registerInputEmail" type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                <small id="emailHelp" class="form-text text-muted">You use this email to log into the site.</small>
            </div>
            <div class="form-group">
                <label for="exampleInputUsername1">Username:</label>
                <input name="registerInputUsername" class="form-control" id="exampleInputUsername1" aria-describedby="emailHelp" placeholder="Enter username">
                <small id="emailHelp" class="form-text text-muted">This is what you will be known as on the RoboRecords.</small>
            </div>

            <div class="form-group">
                <label for="exampleInputPassword1">Password:</label>
                <input name="registerInputPassword" type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">

            </div>
            <div class="form-group">
                <label for="exampleInputConfirmPassword1">Confirm Password:</label>
                <input name="registerInputConfirmPassword" type="password" class="form-control" id="exampleInputConfirmPassword1" placeholder="Confirmation Password" data-toggle="popover" data-placement="left" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">
            </div>
            <hr size="2" width="100%" color="red">
            <button onclick="register()" asp class="btn col-sm-4 col-sm-offset-4 btn-orange btn-lg">Register</button>
        </div>
        <div id="loginBox" class="col-md-6">
            <label class="title-font" id="attractLogin">Login</label>

            <div class="form-group">
                <label for="exampleInputEmail2">Email/Username:</label>
                <input name="loginInputUsername" class="form-control" id="exampleInputEmail2" aria-describedby="emailHelp" placeholder="Email/Username">
            </div>

            <div class="form-group">
                <label for="exampleInputPassword2">Password:</label>
                <input name="loginInputPassword" type="password" class="form-control" id="exampleInputPassword2" placeholder="Password">
            </div>
            <button onclick="login()" class="btn col-sm-4 col-sm-offset-4 btn-blue btn-lg">Login</button>
        </div>
    </div>
</div>

<style type="text/css">
    body {
        background: linear-gradient( rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.75) ), url('../assets/images/login.png');
        background-size: 100%;
        background-repeat: no-repeat;
    }

    #registerBox {
        border: 15px solid #803700;
    }

    #loginBox {
        border: 15px solid #000099;
    }
</style>